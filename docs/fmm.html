---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "fmm.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: fmm.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_BFM" class="doc_header"><code>load_BFM</code><a href="https://github.com/invisprints/face_3dmm/tree/master/face_3dmm/fmm.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_BFM</code>(<strong><code>model_path</code></strong>)</p>
</blockquote>
<p>load BFM 3DMM model
Args:
    model_path: path to BFM model.
Returns:
    model: (nver = 53215, ntri = 105840). nver: number of vertices. ntri: number of triangles.
        'shapeMU': [3<em>nver, 1]
        'shapePC': [3</em>nver, 199]
        'shapeEV': [199, 1]
        'expMU': [3<em>nver, 1]
        'expPC': [3</em>nver, 29]
        'expEV': [29, 1]
        'texMU': [3<em>nver, 1]
        'texPC': [3</em>nver, 199]
        'texEV': [199, 1]
        'tri': [ntri, 3] (start from 1, should sub 1 in python and c++)
        'tri_mouth': [114, 3] (start from 1, as a supplement to mouth triangles)
        'kpt_ind': [68,] (start from 1)
PS:
    You can change codes according to your own saved data.
    Just make sure the model has corresponding attributes.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_BFM_info" class="doc_header"><code>load_BFM_info</code><a href="https://github.com/invisprints/face_3dmm/tree/master/face_3dmm/fmm.py#L55" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_BFM_info</code>(<strong><code>path</code></strong>=<em><code>'BFM_info.mat'</code></em>)</p>
</blockquote>
<p>load 3DMM model extra information
Args:
    path: path to BFM info.
Returns:
    model_info:
        'symlist': 2 x 26720
        'symlist_tri': 2 x 52937
        'segbin': 4 x n (0: nose, 1: eye, 2: mouth, 3: cheek)
        'segbin_tri': 4 x ntri
        'face_contour': 1 x 28
        'face_contour_line': 1 x 512
        'face_contour_front': 1 x 28
        'face_contour_front_line': 1 x 512
        'nose_hole': 1 x 142
        'nose_hole_right': 1 x 71
        'nose_hole_left': 1 x 71
        'parallel': 17 x 1 cell
        'parallel_face_contour': 28 x 1 cell
        'uv_coords': n x 2</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_uv_coords" class="doc_header"><code>load_uv_coords</code><a href="https://github.com/invisprints/face_3dmm/tree/master/face_3dmm/fmm.py#L81" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_uv_coords</code>(<strong><code>path</code></strong>=<em><code>'BFM_UV.mat'</code></em>)</p>
</blockquote>
<p>load uv coords of BFM
Args:
    path: path to data.
Returns:
    uv_coords: [nver, 2]. range: 0-1</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_pncc_code" class="doc_header"><code>load_pncc_code</code><a href="https://github.com/invisprints/face_3dmm/tree/master/face_3dmm/fmm.py#L92" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_pncc_code</code>(<strong><code>path</code></strong>=<em><code>'pncc_code.mat'</code></em>)</p>
</blockquote>
<p>load pncc code of BFM
PNCC code: Defined in 'Face Alignment Across Large Poses: A 3D Solution Xiangyu'
download at <a href="http://www.cbsr.ia.ac.cn/users/xiangyuzhu/projects/3DDFA/main.htm">http://www.cbsr.ia.ac.cn/users/xiangyuzhu/projects/3DDFA/main.htm</a>.
Args:
    path: path to data.
Returns:
    pncc_code: [nver, 3]</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_organ_ind" class="doc_header"><code>get_organ_ind</code><a href="https://github.com/invisprints/face_3dmm/tree/master/face_3dmm/fmm.py#L106" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_organ_ind</code>(<strong><code>model_info</code></strong>)</p>
</blockquote>
<p>get nose, eye, mouth index</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="estimate_shape" class="doc_header"><code>estimate_shape</code><a href="https://github.com/invisprints/face_3dmm/tree/master/face_3dmm/fmm.py#L116" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>estimate_shape</code>(<strong><code>x</code></strong>, <strong><code>shapeMU</code></strong>, <strong><code>shapePC</code></strong>, <strong><code>shapeEV</code></strong>, <strong><code>expression</code></strong>, <strong><code>s</code></strong>, <strong><code>R</code></strong>, <strong><code>t2d</code></strong>, <strong><code>lamb</code></strong>=<em><code>3000</code></em>)</p>
</blockquote>
<p>Args:
    x: (2, n). image points (to be fitted)
    shapeMU: (3n, 1)
    shapePC: (3n, n_sp)
    shapeEV: (n_sp, 1)
    expression: (3, n)
    s: scale
    R: (3, 3). rotation matrix
    t2d: (2,). 2d translation
    lambda: regulation coefficient
Returns:
    shape_para: (n_sp, 1) shape parameters(coefficients)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="estimate_expression" class="doc_header"><code>estimate_expression</code><a href="https://github.com/invisprints/face_3dmm/tree/master/face_3dmm/fmm.py#L168" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>estimate_expression</code>(<strong><code>x</code></strong>, <strong><code>shapeMU</code></strong>, <strong><code>expPC</code></strong>, <strong><code>expEV</code></strong>, <strong><code>shape</code></strong>, <strong><code>s</code></strong>, <strong><code>R</code></strong>, <strong><code>t2d</code></strong>, <strong><code>lamb</code></strong>=<em><code>2000</code></em>)</p>
</blockquote>
<p>Args:
    x: (2, n). image points (to be fitted)
    shapeMU: (3n, 1)
    expPC: (3n, n_ep)
    expEV: (n_ep, 1)
    shape: (3, n)
    s: scale
    R: (3, 3). rotation matrix
    t2d: (2,). 2d translation
    lambda: regulation coefficient
Returns:
    exp_para: (n_ep, 1) shape parameters(coefficients)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fit_points" class="doc_header"><code>fit_points</code><a href="https://github.com/invisprints/face_3dmm/tree/master/face_3dmm/fmm.py#L219" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fit_points</code>(<strong><code>x</code></strong>, <strong><code>X_ind</code></strong>, <strong><code>model</code></strong>, <strong><code>n_sp</code></strong>, <strong><code>n_ep</code></strong>, <strong><code>max_iter</code></strong>=<em><code>4</code></em>)</p>
</blockquote>
<p>Args:
    x: (n, 2) image points
    X_ind: (n,) corresponding Model vertex indices
    model: 3DMM
    max_iter: iteration
Returns:
    sp: (n_sp, 1). shape parameters
    ep: (n_ep, 1). exp parameters
    s, R, t</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fit_points_for_show" class="doc_header"><code>fit_points_for_show</code><a href="https://github.com/invisprints/face_3dmm/tree/master/face_3dmm/fmm.py#L272" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fit_points_for_show</code>(<strong><code>x</code></strong>, <strong><code>X_ind</code></strong>, <strong><code>model</code></strong>, <strong><code>n_sp</code></strong>, <strong><code>n_ep</code></strong>, <strong><code>max_iter</code></strong>=<em><code>4</code></em>)</p>
</blockquote>
<p>Args:
    x: (n, 2) image points
    X_ind: (n,) corresponding Model vertex indices
    model: 3DMM
    max_iter: iteration
Returns:
    sp: (n_sp, 1). shape parameters
    ep: (n_ep, 1). exp parameters
    s, R, t</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MorphabelModel" class="doc_header"><code>class</code> <code>MorphabelModel</code><a href="https://github.com/invisprints/face_3dmm/tree/master/face_3dmm/fmm.py#L331" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MorphabelModel</code>(<strong><code>model_path</code></strong>, <strong><code>model_type</code></strong>=<em><code>'BFM'</code></em>)</p>
</blockquote>
<p>docstring for  MorphabelModel
model: nver: number of vertices. ntri: number of triangles. <em>: must have. ~: can generate ones array for place holder.
        'shapeMU': [3</em>nver, 1]. <em>
        'shapePC': [3</em>nver, n_shape_para]. <em>
        'shapeEV': [n_shape_para, 1]. ~
        'expMU': [3</em>nver, 1]. ~
        'expPC': [3<em>nver, n_exp_para]. ~
        'expEV': [n_exp_para, 1]. ~
        'texMU': [3</em>nver, 1]. ~
        'texPC': [3<em>nver, n_tex_para]. ~
        'texEV': [n_tex_para, 1]. ~
        'tri': [ntri, 3] (start from 1, should sub 1 in python and c++). </em>
        'tri_mouth': [114, 3] (start from 1, as a supplement to mouth triangles). ~
        'kpt_ind': [68,] (start from 1). ~</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 3dmm.ipynb.
Converted index.ipynb.
Converted io.ipynb.
Converted transform.ipynb.
Converted utils.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

